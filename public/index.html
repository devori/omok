<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="./lib/cocos2d-js-v3.10/cocos2d-js-v3.10.js" charset="UTF-8"></script>
</head>
<body>
<canvas id="gameCanvas" width="800" height="800"></canvas>
<script type="text/javascript">
    window.onload = function () {
        cc.game.onStart = function () {
            //load resources
            cc.LoaderScene.preload(["./images/go_board.png"], function () {

                var MyScene = cc.Scene.extend({
                    init: function () {

                    },
                    onEnter: function () {
                        this._super();

                        var layer = new ReadyLayer();
                        this.addChild(layer, 0)
                        layer.init();
                    }
                });

                var myScene = new MyScene();


                var ReadyLayer = cc.Layer.extend({
                    sprite: null,
                    tag: "readyLayer",
                    ctor: function () {
                        this._super();
                        var size = cc.winSize;
                        this.sprite = new cc.Sprite("./images/basic_img02.png");
                        this.sprite.attr({
                            x: size.width / 2,
                            y: size.height / 2
                        });
                        this.addChild(this.sprite, 0);
                        this.sprite.tag = 'TouchTarget';

                        //Creating Event Listener Object
                        var listener = cc.EventListener.create({
                            event: cc.EventListener.MOUSE,
                            swallowTouches: true,
                            ismousedown: false,
                            onMouseDown: function (event) {
                                var target = event.getCurrentTarget();
                                var locationInNode = target.convertToNodeSpace(event.getLocation());
                                var s = target.getContentSize();
                                var rect = cc.rect(0, 0, s.width, s.height);

                                //Check the click area
                                if (cc.rectContainsPoint(rect, locationInNode)) {
                                    myScene.removeChildByTag("readyLayer");

                                    cc.eventManager.removeAllListeners();

                                    var gameLayer = new GameLayer();

                                    myScene.addChild(gameLayer, 0, "gameLayer");
                                    gameLayer.init();
                                    this.ismousedown = true;
                                }
                                return false;
                            }
                        });

                        //Added Event Listener To Sprite
                        cc.eventManager.addListener(listener, this.sprite);
                        return true;
                    }
                });

                var GameLayer = cc.Layer.extend({
                    init: function () {
                        var size = cc.director.getWinSize();
                        var board = cc.Sprite.create("./images/go_board.png");
                        board.setPosition(size.width / 2, size.height / 2);
                        board.setScale(0.4);
                        this.addChild(board, 0);

                        var scene = this;
                        var listener = cc.EventListener.create({
                            event : cc.EventListener.CUSTOM,
                            eventName: "onStone",
                            callback: function (evt) {

                                var sprite;
                                var userData = evt.getUserData();
                                var type = userData.type, x = userData.x, y = userData.y;
                                if (type === "BLACK") {
                                    sprite = cc.Sprite.create("./images/black_stone.png");
                                } else {
                                    sprite = cc.Sprite.create("./images/white_stone.png");
                                }

                                var hCenter = size.width / 2;
                                var vCenter = size.height / 2;
                                var unitWidth = size.width/19.2;
                                var unitHeight = size.height/19.2;

                                sprite.setPosition(hCenter - ((9 - x) * unitWidth), vCenter - ((9 - y) * unitHeight));
                                sprite.setScale(0.08);
                                scene.addChild(sprite, 0);
                            }
                        });
                        cc.eventManager.addListener(listener, 1);
                    }
                });


                cc.director.runScene(myScene);
            }, this);
        };
        cc.game.run("gameCanvas");
    };
</script>
</body>
</html>